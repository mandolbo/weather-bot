<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DART ì¬ë¬´ì œí‘œ ë¶„ì„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --apple-blue: #007AFF;
            --apple-gray: #F2F2F7;
            --apple-dark-gray: #8E8E93;
            --apple-light-gray: #F9F9F9;
            --apple-white: #FFFFFF;
            --apple-black: #1D1D1F;
            --apple-green: #30D158;
            --apple-orange: #FF9500;
            --apple-red: #FF3B30;
            --apple-purple: #AF52DE;
            --shadow: rgba(0, 0, 0, 0.1);
            --shadow-light: rgba(0, 0, 0, 0.05);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            color: var(--apple-black);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--apple-black);
            letter-spacing: -0.5px;
        }

        .logo .accent {
            color: var(--apple-blue);
        }

        /* Main Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 24px;
        }

        /* Search Section */
        .search-section {
            background: var(--apple-white);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 32px;
            box-shadow: 0 4px 24px var(--shadow-light);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .search-title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--apple-black);
        }

        .search-subtitle {
            color: var(--apple-dark-gray);
            margin-bottom: 32px;
            font-size: 16px;
        }

        .search-form {
            display: flex;
            gap: 16px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .input-group {
            position: relative;
            flex: 1;
            min-width: 200px;
        }

        .input-group label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--apple-dark-gray);
            margin-bottom: 8px;
        }

        .input-field, .select-field {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--apple-gray);
            border-radius: 12px;
            font-size: 16px;
            background: var(--apple-white);
            transition: all 0.3s ease;
            outline: none;
        }

        .input-field:focus, .select-field:focus {
            border-color: var(--apple-blue);
            box-shadow: 0 0 0 4px rgba(0, 122, 255, 0.1);
        }

        .company-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--apple-white);
            border: 2px solid var(--apple-gray);
            border-top: none;
            border-radius: 0 0 12px 12px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
        }

        .company-dropdown.show {
            display: block;
        }

        .company-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            transition: background-color 0.2s ease;
        }

        .company-item:hover {
            background: var(--apple-gray);
        }

        .company-item:last-child {
            border-bottom: none;
        }

        .search-btn {
            background: var(--apple-blue);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 16px 32px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
            height: fit-content;
            align-self: end;
        }

        .search-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 122, 255, 0.3);
        }

        .search-btn:active {
            transform: translateY(0);
        }

        /* Status Message */
        .status-message {
            padding: 16px 20px;
            border-radius: 12px;
            margin-bottom: 24px;
            font-size: 16px;
            display: none;
        }

        .status-message.info {
            background: rgba(0, 122, 255, 0.1);
            color: var(--apple-blue);
            border: 1px solid rgba(0, 122, 255, 0.2);
        }

        .status-message.success {
            background: #d4edda;
            color: #155724;
            border-color: #c3e6cb;
        }

        .status-message.warning {
            background: #fff3cd;
            color: #856404;
            border-color: #ffeaa7;
        }

        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border-color: #f5c6cb;
        }

        .status-message.show {
            display: block;
        }

        /* Tab Navigation */
        .tab-navigation {
            background: var(--apple-white);
            border-radius: 16px;
            padding: 8px;
            margin-bottom: 24px;
            display: flex;
            gap: 4px;
            box-shadow: 0 2px 12px var(--shadow-light);
        }

        .tab-btn {
            flex: 1;
            padding: 12px 16px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: var(--apple-dark-gray);
        }

        .tab-btn.active {
            background: var(--apple-blue);
            color: white;
            box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
        }

        /* Statement Navigation */
        .statement-navigation {
            background: var(--apple-white);
            border-radius: 12px;
            padding: 6px;
            margin-bottom: 24px;
            display: flex;
            gap: 3px;
            box-shadow: 0 1px 8px var(--shadow-light);
        }

        .statement-btn {
            flex: 1;
            padding: 10px 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            background: transparent;
            color: var(--apple-dark-gray);
        }

        .statement-btn.active {
            background: var(--apple-green);
            color: white;
            box-shadow: 0 1px 4px rgba(48, 209, 88, 0.3);
        }

        /* Content Sections */
        .content-section {
            display: none;
            background: var(--apple-white);
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 4px 24px var(--shadow-light);
        }

        .content-section.active {
            display: block;
        }

        /* Financial Ratios Summary */
        .financial-summary {
            margin: 32px 0;
            padding: 32px;
            background: var(--apple-white);
            border-radius: 20px;
            box-shadow: 0 4px 24px var(--shadow-light);
        }

        .summary-title {
            font-size: 22px;
            font-weight: 600;
            margin-bottom: 24px;
            color: var(--apple-black);
            text-align: center;
        }

        .ratios-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .ratio-card {
            background: var(--apple-light-gray);
            border-radius: 16px;
            padding: 24px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .ratio-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px var(--shadow);
        }

        .ratio-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--apple-dark-gray);
            margin-bottom: 8px;
        }

        .ratio-value {
            font-size: 28px;
            font-weight: 700;
            color: var(--apple-blue);
            margin-bottom: 4px;
        }

        .ratio-description {
            font-size: 14px;
            color: var(--apple-dark-gray);
        }

        /* AI Analysis Section - Apple Style */
        .ai-analysis-section {
            margin-top: 32px;
            padding: 0;
            background: transparent;
        }

        .ai-header {
            text-align: center;
            margin-bottom: 32px;
        }

        .ai-title {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
        }

        .ai-subtitle {
            font-size: 18px;
            color: var(--apple-dark-gray);
        }

        .ai-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }

        .ai-btn {
            background: var(--apple-white);
            border: 2px solid var(--apple-gray);
            color: var(--apple-black);
            padding: 32px 24px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 12px var(--shadow-light);
        }

        .ai-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent 0%, rgba(0, 122, 255, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .ai-btn:hover {
            border-color: var(--apple-blue);
            transform: translateY(-4px);
            box-shadow: 0 12px 32px rgba(0, 122, 255, 0.2);
        }

        .ai-btn:hover::before {
            opacity: 1;
        }

        .ai-btn-icon {
            font-size: 32px;
            margin-bottom: 12px;
            display: block;
        }

        .ai-btn-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            position: relative;
            z-index: 1;
        }

        .ai-btn-desc {
            font-size: 14px;
            color: var(--apple-dark-gray);
            position: relative;
            z-index: 1;
        }

        /* Chart Container */
        .chart-container {
            margin: 24px 0;
            padding: 20px;
            background: var(--apple-light-gray);
            border-radius: 12px;
            height: 400px;
        }

        /* Data Table */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 24px;
            background: var(--apple-white);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 12px var(--shadow-light);
        }

        .data-table th {
            background: var(--apple-gray);
            padding: 16px;
            text-align: left;
            font-weight: 600;
            color: var(--apple-black);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .data-table td {
            padding: 14px 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .data-table tr:hover {
            background: rgba(0, 122, 255, 0.05);
        }

        /* Loading Animation */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 40px;
            color: var(--apple-dark-gray);
        }

        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid var(--apple-gray);
            border-top: 3px solid var(--apple-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 12px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 20px 16px;
            }

            .search-form {
                flex-direction: column;
            }

            .input-group {
                min-width: auto;
            }

            .search-section {
                padding: 24px;
            }

            .content-section {
                padding: 20px;
            }

            .ai-buttons {
                grid-template-columns: 1fr;
            }
        }

        /* AI Analysis Cards */
        .ai-analysis-card {
            background: var(--apple-white);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 12px var(--shadow-light);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .ai-analysis-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px var(--shadow-light);
        }

        .ai-card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            gap: 16px;
        }

        .ai-card-icon {
            font-size: 32px;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            flex-shrink: 0;
        }

        .ai-card-content {
            flex: 1;
        }

        .ai-card-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--apple-black);
            margin: 0 0 6px 0;
        }

        .ai-card-desc {
            font-size: 14px;
            color: var(--apple-dark-gray);
            margin: 0;
            line-height: 1.4;
        }

        .ai-analyze-btn {
            background: linear-gradient(135deg, var(--apple-blue) 0%, #4dabf7 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 14px 28px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            width: 100%;
            justify-content: center;
            margin-bottom: 16px;
        }

        .ai-analyze-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 16px rgba(0, 122, 255, 0.3);
        }

        .ai-analyze-btn:active {
            transform: translateY(0);
        }

        .btn-icon {
            font-size: 18px;
        }

        /* Analysis Result */
        .analysis-result {
            margin-top: 20px;
            padding: 20px;
            background: var(--apple-light-gray);
            border-radius: 12px;
            display: none;
            border-left: 4px solid var(--apple-blue);
        }

        .analysis-result.show {
            display: block;
        }

        .analysis-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--apple-black);
        }

        .analysis-content {
            line-height: 1.6;
            color: var(--apple-black);
            white-space: pre-wrap;
            font-size: 14px;
        }

        .analysis-info {
            margin-bottom: 16px;
        }

        .error-message {
            color: var(--apple-red);
        }

        /* ë¹„êµ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .comparison-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--apple-white);
            border-radius: 20px;
            max-width: 900px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--apple-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--apple-black);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--apple-dark-gray);
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: var(--apple-gray);
            color: var(--apple-black);
        }

        .modal-body {
            padding: 24px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .comparison-section {
            background: var(--apple-light-gray);
            padding: 20px;
            border-radius: 12px;
        }

        .comparison-section h4 {
            margin: 0 0 12px 0;
            font-size: 18px;
        }

        .comparison-section p {
            margin: 8px 0;
            font-size: 14px;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px;
            text-align: right;
            border-bottom: 1px solid var(--apple-gray);
        }

        .comparison-table th:first-child,
        .comparison-table td:first-child {
            text-align: left;
        }

        .comparison-table th {
            background: var(--apple-light-gray);
            font-weight: 600;
            color: var(--apple-black);
        }

        .detailed-comparison h4 {
            margin: 0 0 16px 0;
            color: var(--apple-blue);
        }

        /* ë¹„êµ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .compare-btn {
            background: var(--apple-purple);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 12px;
        }

        .compare-btn:hover {
            background: #9A44C7;
            transform: translateY(-1px);
        }

        /* í…ŒìŠ¤íŠ¸ ê²°ê³¼ ìŠ¤íƒ€ì¼ */
        .test-section {
            margin-bottom: 24px;
            padding: 16px;
            background: var(--apple-light-gray);
            border-radius: 8px;
        }

        .test-section h4 {
            margin: 0 0 12px 0;
            color: var(--apple-blue);
        }

        .test-section p {
            margin: 8px 0;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                DART <span class="accent">Financial</span>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Search Section -->
        <section class="search-section">
            <h1 class="search-title">ê¸°ì—… ì¬ë¬´ì œí‘œ ë¶„ì„</h1>
            <p class="search-subtitle">í•œêµ­ ìƒì¥ê¸°ì—… ì¬ë¬´ì •ë³´ ì¡°íšŒ ë° AI ë¶„ì„</p>
            
            <form class="search-form" id="searchForm">
                <div class="input-group">
                    <label for="companyInput">ê¸°ì—…ëª…</label>
                    <input type="text" id="companyInput" class="input-field" placeholder="ì‚¼ì„±ì „ì" autocomplete="off">
                    <div class="company-dropdown" id="companyDropdown"></div>
                </div>
                
                <div class="input-group">
                    <label for="yearSelect">ì‚¬ì—…ì—°ë„</label>
                    <select id="yearSelect" class="select-field">
                        <option value="2024">2024ë…„</option>
                        <option value="2023">2023ë…„</option>
                        <option value="2022">2022ë…„</option>
                        <option value="2021">2021ë…„</option>
                        <option value="2020">2020ë…„</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="reportSelect">ì¬ë¬´ì œí‘œ ìœ í˜•</label>
                    <select id="reportSelect" class="select-field">
                        <option value="ì—°ê²°ì¬ë¬´ì œí‘œ">ì—°ê²°ì¬ë¬´ì œí‘œ</option>
                        <option value="ë³„ë„ì¬ë¬´ì œí‘œ">ë³„ë„ì¬ë¬´ì œí‘œ</option>
                    </select>
                </div>
                
                <button type="submit" class="search-btn">ì¡°íšŒ</button>
            </form>

            <div class="status-message" id="statusMessage"></div>
        </section>

        <!-- Tab Navigation -->
        <nav class="tab-navigation" id="tabNavigation" style="display: none;">
            <button class="tab-btn active" data-tab="quarterly">ë¶„ê¸°ë³„ ë¶„ì„</button>
            <button class="tab-btn" data-tab="comparison">ë‹¤ë…„ë„ ë¹„êµ</button>
            <button class="tab-btn" data-tab="detailed">ìƒì„¸ ì¬ë¬´ì œí‘œ</button>
        </nav>

        <!-- Statement Type Navigation -->
        <nav class="statement-navigation" id="statementNavigation" style="display: none;">
            <button class="statement-btn active" data-statement="BS">ì¬ë¬´ìƒíƒœí‘œ</button>
            <button class="statement-btn" data-statement="IS">í¬ê´„ì†ìµê³„ì‚°ì„œ</button>
            <button class="statement-btn" data-statement="CF">í˜„ê¸ˆíë¦„í‘œ</button>
            <button class="statement-btn" data-statement="SCE">ìë³¸ë³€ë™í‘œ</button>
            <button class="compare-btn" onclick="compareFinancialStatements()">
                <span>ğŸ”</span> ë³„ë„/ì—°ê²° ë¹„êµ
            </button>
            <button class="compare-btn" onclick="testFsDifference()" style="background: var(--apple-orange);">
                <span>ğŸ§ª</span> ì°¨ì´ í…ŒìŠ¤íŠ¸
            </button>
        </nav>

        <!-- Content Sections -->
        <section id="quarterlySection" class="content-section active">
            <h2>ë¶„ê¸°ë³„ ì¬ë¬´ì œí‘œ ë¶„ì„</h2>
            <div class="chart-container">
                <canvas id="quarterlyChart"></canvas>
            </div>
            <div id="quarterlyData"></div>
        </section>

        <section id="comparisonSection" class="content-section">
            <h2>ë‹¤ë…„ë„ ë¹„êµ ë¶„ì„</h2>
            <div class="chart-container">
                <canvas id="comparisonChart"></canvas>
            </div>
            <div id="comparisonData"></div>
        </section>

        <section id="detailedSection" class="content-section">
            <h2>ìƒì„¸ ì¬ë¬´ì œí‘œ</h2>
            <div class="chart-container">
                <canvas id="detailedChart"></canvas>
            </div>
            <div id="detailedData"></div>
        </section>

        <!-- Financial Summary Section -->
        <section class="financial-summary" id="financialSummary" style="display: none;">
            <h3 class="summary-title">ğŸ“Š ì£¼ìš” ì¬ë¬´ ì§€í‘œ</h3>
            <div class="ratios-grid" id="ratiosGrid">
                <!-- Dynamic content -->
            </div>
        </section>

        <!-- AI Analysis Section -->
        <section class="ai-analysis-section" id="aiAnalysisSection" style="display: none;">
            <div class="ai-header">
                <h3 class="ai-title">AI ì¬ë¬´ ë¶„ì„</h3>
                <p class="ai-subtitle">ì¸ê³µì§€ëŠ¥ì´ ì œê³µí•˜ëŠ” ì „ë¬¸ì ì¸ ì¬ë¬´ ë¶„ì„</p>
            </div>
            
            <!-- ì¬ë¬´ë¹„ìœ¨ ë¶„ì„ ì¹´ë“œ -->
            <div class="ai-analysis-card">
                <div class="ai-card-header">
                    <span class="ai-card-icon">ğŸ“Š</span>
                    <div class="ai-card-content">
                        <h4 class="ai-card-title">ì¬ë¬´ë¹„ìœ¨ ë¶„ì„</h4>
                        <p class="ai-card-desc">ROE, ROA, ë¶€ì±„ë¹„ìœ¨ ë“± í•µì‹¬ ì¬ë¬´ë¹„ìœ¨ ì‹¬ì¸µ ë¶„ì„</p>
                    </div>
                </div>
                <button class="ai-analyze-btn" onclick="performAIAnalysis('ratios')">
                    <span class="btn-icon">ğŸ”</span>
                    ë¶„ì„ ì‹œì‘
                </button>
                <div class="analysis-result" id="ratiosAnalysisResult" style="display: none;">
                    <h5 class="analysis-title">ì¬ë¬´ë¹„ìœ¨ ë¶„ì„ ê²°ê³¼</h5>
                    <div class="analysis-content" id="ratiosAnalysisContent"></div>
                </div>
            </div>

            <!-- ì¶”ì„¸ ë¶„ì„ ì¹´ë“œ -->
            <div class="ai-analysis-card">
                <div class="ai-card-header">
                    <span class="ai-card-icon">ğŸ“ˆ</span>
                    <div class="ai-card-content">
                        <h4 class="ai-card-title">ì¶”ì„¸ ë¶„ì„</h4>
                        <p class="ai-card-desc">ì‹œê³„ì—´ ë°ì´í„° ê¸°ë°˜ ì„±ì¥ íŒ¨í„´ ë° íŠ¸ë Œë“œ ë¶„ì„</p>
                    </div>
                </div>
                <button class="ai-analyze-btn" onclick="performAIAnalysis('trends')">
                    <span class="btn-icon">ğŸ“Š</span>
                    ë¶„ì„ ì‹œì‘
                </button>
                <div class="analysis-result" id="trendsAnalysisResult" style="display: none;">
                    <h5 class="analysis-title">ì¶”ì„¸ ë¶„ì„ ê²°ê³¼</h5>
                    <div class="analysis-content" id="trendsAnalysisContent"></div>
                </div>
            </div>

            <!-- íˆ¬ì ë¶„ì„ ì¹´ë“œ -->
            <div class="ai-analysis-card">
                <div class="ai-card-header">
                    <span class="ai-card-icon">ğŸ’</span>
                    <div class="ai-card-content">
                        <h4 class="ai-card-title">íˆ¬ì ë¶„ì„</h4>
                        <p class="ai-card-desc">íˆ¬ì ê°€ì¹˜ í‰ê°€ ë° íˆ¬ì ë§¤ë ¥ë„ ì¢…í•© ë¶„ì„</p>
                    </div>
                </div>
                <button class="ai-analyze-btn" onclick="performAIAnalysis('investment')">
                    <span class="btn-icon">ğŸ’°</span>
                    ë¶„ì„ ì‹œì‘
                </button>
                <div class="analysis-result" id="investmentAnalysisResult" style="display: none;">
                    <h5 class="analysis-title">íˆ¬ì ë¶„ì„ ê²°ê³¼</h5>
                    <div class="analysis-content" id="investmentAnalysisContent"></div>
                </div>
            </div>

            <!-- ì¢…í•© ë¶„ì„ ì¹´ë“œ -->
            <div class="ai-analysis-card">
                <div class="ai-card-header">
                    <span class="ai-card-icon">ğŸ¯</span>
                    <div class="ai-card-content">
                        <h4 class="ai-card-title">ì¢…í•© ë¶„ì„</h4>
                        <p class="ai-card-desc">ì „ì²´ì ì¸ ì¬ë¬´ ìƒíƒœ ë° ê²½ì˜ ì„±ê³¼ ì¢…í•© í‰ê°€</p>
                    </div>
                </div>
                <button class="ai-analyze-btn" onclick="performAIAnalysis('comprehensive')">
                    <span class="btn-icon">ğŸ§ </span>
                    ë¶„ì„ ì‹œì‘
                </button>
                <div class="analysis-result" id="comprehensiveAnalysisResult" style="display: none;">
                    <h5 class="analysis-title">ì¢…í•© ë¶„ì„ ê²°ê³¼</h5>
                    <div class="analysis-content" id="comprehensiveAnalysisContent"></div>
                </div>
            </div>
        </section>
    </div>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentCorpCode = '';
        let currentCorpName = '';
        let currentYear = '2024';
        let currentFsDiv = 'CFS';
        let currentStatementType = 'BS'; // í˜„ì¬ ì¬ë¬´ì œí‘œ ìœ í˜•
        let quarterlyChartInstance = null;
        let comparisonChartInstance = null;
        let detailedChartInstance = null;

        // DOM ìš”ì†Œ
        const companyInput = document.getElementById('companyInput');
        const companyDropdown = document.getElementById('companyDropdown');
        const yearSelect = document.getElementById('yearSelect');
        const reportSelect = document.getElementById('reportSelect');
        const searchForm = document.getElementById('searchForm');
        const statusMessage = document.getElementById('statusMessage');
        const tabNavigation = document.getElementById('tabNavigation');
        const statementNavigation = document.getElementById('statementNavigation');
        const aiAnalysisSection = document.getElementById('aiAnalysisSection');

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            setupEventListeners();
            updateYearOptions();
        });

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            // íšŒì‚¬ëª… ì…ë ¥ ì´ë²¤íŠ¸
            companyInput.addEventListener('input', handleCompanyInput);
            companyInput.addEventListener('blur', () => {
                setTimeout(() => companyDropdown.classList.remove('show'), 200);
            });

            // í¼ ì œì¶œ ì´ë²¤íŠ¸
            searchForm.addEventListener('submit', handleFormSubmit);

            // íƒ­ í´ë¦­ ì´ë²¤íŠ¸
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.getAttribute('data-tab');
                    switchTab(tab);
                });
            });

            // ì¬ë¬´ì œí‘œ ìœ í˜• í´ë¦­ ì´ë²¤íŠ¸
            document.querySelectorAll('.statement-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const statementType = btn.getAttribute('data-statement');
                    switchStatementType(statementType);
                });
            });

            // ë¬¸ì„œ í´ë¦­ ì´ë²¤íŠ¸ (ë“œë¡­ë‹¤ìš´ ë‹«ê¸°)
            document.addEventListener('click', (e) => {
                if (!companyInput.contains(e.target) && !companyDropdown.contains(e.target)) {
                    companyDropdown.classList.remove('show');
                }
            });
        }

        // ì—°ë„ ì˜µì…˜ ì—…ë°ì´íŠ¸
        function updateYearOptions() {
            const currentYear = new Date().getFullYear();
            yearSelect.innerHTML = '';
            
            for (let year = currentYear; year >= currentYear - 10; year--) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = `${year}ë…„`;
                yearSelect.appendChild(option);
            }
        }

        // íšŒì‚¬ëª… ì…ë ¥ ì²˜ë¦¬
        function handleCompanyInput(e) {
            const query = e.target.value.trim();
            
            if (query.length >= 2) {
                searchCompanies(query);
            } else {
                companyDropdown.classList.remove('show');
            }
        }

        // íšŒì‚¬ ê²€ìƒ‰
        async function searchCompanies(query) {
            try {
                const response = await fetch(`/api/search_corp?name=${encodeURIComponent(query)}`);
                const data = await response.json();
                
                if (data.success && data.results && data.results.length > 0) {
                    displayCompanyDropdown(data.results);
                } else {
                    companyDropdown.classList.remove('show');
                }
            } catch (error) {
                console.error('íšŒì‚¬ ê²€ìƒ‰ ì˜¤ë¥˜:', error);
                companyDropdown.classList.remove('show');
            }
        }

        // íšŒì‚¬ ë“œë¡­ë‹¤ìš´ í‘œì‹œ
        function displayCompanyDropdown(companies) {
            companyDropdown.innerHTML = '';
            
            companies.forEach(company => {
                const item = document.createElement('div');
                item.className = 'company-item';
                item.textContent = company.corp_name;
                item.addEventListener('click', () => {
                    selectCompany(company);
                });
                companyDropdown.appendChild(item);
            });
            
            companyDropdown.classList.add('show');
        }

        // íšŒì‚¬ ì„ íƒ
        function selectCompany(company) {
            // ê¸°ì¡´ ë¶„ì„ ê²°ê³¼ ëª¨ë‘ ì´ˆê¸°í™”
            clearAllAnalysisResults();
            
            // ì´ì „ ê¸°ì—… ì •ë³´ ë¡œê·¸
            console.log(`ğŸ”„ ê¸°ì—… ë³€ê²½: ${currentCorpName || 'ì—†ìŒ'} â†’ ${company.corp_name}`);
            
            companyInput.value = company.corp_name;
            currentCorpCode = company.corp_code;
            currentCorpName = company.corp_name;
            companyDropdown.classList.remove('show');
            
            // AI ë¶„ì„ ì„¹ì…˜ê³¼ ì¬ë¬´ì§€í‘œ ìš”ì•½ ìˆ¨ê¹€ (ìƒˆë¡œ ì¡°íšŒí•  ë•Œê¹Œì§€)
            const aiAnalysisSection = document.getElementById('aiAnalysisSection');
            const financialSummary = document.getElementById('financialSummary');
            
            if (aiAnalysisSection) {
                aiAnalysisSection.style.display = 'none';
            }
            if (financialSummary) {
                financialSummary.style.display = 'none';
            }
            
            console.log(`âœ… ìƒˆ ê¸°ì—… ì„ íƒ ì™„ë£Œ: ${currentCorpName} (${currentCorpCode})`);
        }

        // í¼ ì œì¶œ ì²˜ë¦¬
        function handleFormSubmit(e) {
            e.preventDefault();
            
            if (!currentCorpCode || !currentCorpName) {
                showMessage('ê¸°ì—…ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            currentYear = yearSelect.value;
            currentFsDiv = reportSelect.value === 'ì—°ê²°ì¬ë¬´ì œí‘œ' ? 'CFS' : 'OFS';
            
            // í˜„ì¬ ì„ íƒëœ ì •ë³´ í‘œì‹œ
            const fsTypeText = currentFsDiv === 'CFS' ? 'ì—°ê²°ì¬ë¬´ì œí‘œ' : 'ë³„ë„ì¬ë¬´ì œí‘œ';
            showMessage(`${currentCorpName} ${currentYear}ë…„ ${fsTypeText} ë°ì´í„°ë¥¼ ì¡°íšŒí•˜ê³  ìˆìŠµë‹ˆë‹¤...`, 'info');
            
            // ê¸°ì¡´ AI ë¶„ì„ ê²°ê³¼ ëª¨ë‘ ì´ˆê¸°í™”
            clearAllAnalysisResults();
            
            // íƒ­ ë„¤ë¹„ê²Œì´ì…˜ í‘œì‹œ
            tabNavigation.style.display = 'flex';
            statementNavigation.style.display = 'flex';
            document.getElementById('financialSummary').style.display = 'block';
            aiAnalysisSection.style.display = 'block';
            
            // AI ë¶„ì„ ì„¹ì…˜ ì œëª© ê°•ì œ ì—…ë°ì´íŠ¸
            forceUpdateAIAnalysisSection();
            
            // í˜„ì¬ í™œì„± íƒ­ì— ë”°ë¼ ë°ì´í„° ë¡œë“œ
            const activeTab = document.querySelector('.tab-btn.active').getAttribute('data-tab');
            loadDataForTab(activeTab);
        }

        // ëª¨ë“  AI ë¶„ì„ ê²°ê³¼ ì´ˆê¸°í™”
        function clearAllAnalysisResults() {
            const analysisTypes = ['ratios', 'trends', 'investment', 'comprehensive'];
            analysisTypes.forEach(type => {
                const resultDiv = document.getElementById(`${type}AnalysisResult`);
                if (resultDiv) {
                    resultDiv.style.display = 'none';
                    const contentDiv = document.getElementById(`${type}AnalysisContent`);
                    if (contentDiv) {
                        contentDiv.innerHTML = '';
                    }
                }
            });
        }

        // AI ë¶„ì„ ì„¹ì…˜ ê°•ì œ ì—…ë°ì´íŠ¸
        function forceUpdateAIAnalysisSection() {
            const fsTypeText = currentFsDiv === 'CFS' ? 'ì—°ê²°ì¬ë¬´ì œí‘œ' : 'ë³„ë„ì¬ë¬´ì œí‘œ';
            
            // AI ë¶„ì„ ì„¹ì…˜ ì œëª© ì—…ë°ì´íŠ¸
            const aiSectionTitle = document.querySelector('#aiAnalysisSection .ai-title');
            if (aiSectionTitle) {
                aiSectionTitle.textContent = `ğŸ¤– AI ì¬ë¬´ë¶„ì„ - ${currentCorpName} (${currentYear}ë…„ ${fsTypeText})`;
            }
            
            // ì¬ë¬´ì§€í‘œ ìš”ì•½ ì„¹ì…˜ ì´ˆê¸°í™”
            const financialSummary = document.getElementById('financialSummary');
            if (financialSummary) {
                financialSummary.innerHTML = `
                    <h3>ğŸ“Š ì¬ë¬´ì§€í‘œ ìš”ì•½ - ${currentCorpName} (${currentYear}ë…„ ${fsTypeText})</h3>
                    <div class="summary-grid">
                        <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
                    </div>
                `;
            }
            
            console.log(`âœ… AI ì„¹ì…˜ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${currentCorpName}`);
        }

        // íƒ­ ì „í™˜
        function switchTab(tab) {
            // íƒ­ ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active');
            
            // ì½˜í…ì¸  ì„¹ì…˜ í‘œì‹œ
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(`${tab}Section`).classList.add('active');
            
            // ë°ì´í„° ë¡œë“œ
            loadDataForTab(tab);
        }

        // ì¬ë¬´ì œí‘œ ìœ í˜• ì „í™˜
        function switchStatementType(statementType) {
            // ë²„íŠ¼ í™œì„±í™”
            document.querySelectorAll('.statement-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-statement="${statementType}"]`).classList.add('active');
            
            // í˜„ì¬ ì¬ë¬´ì œí‘œ ìœ í˜• ì—…ë°ì´íŠ¸
            currentStatementType = statementType;
            
            const fsTypeText = currentFsDiv === 'CFS' ? 'ì—°ê²°ì¬ë¬´ì œí‘œ' : 'ë³„ë„ì¬ë¬´ì œí‘œ';
            showMessage(`${currentCorpName} ${statementType} ${fsTypeText} ë°ì´í„°ë¥¼ ì¡°íšŒí•©ë‹ˆë‹¤...`, 'info');
            
            // AI ë¶„ì„ ì„¹ì…˜ ì œëª© ë‹¤ì‹œ ì—…ë°ì´íŠ¸
            forceUpdateAIAnalysisSection();
            
            // í˜„ì¬ í™œì„± íƒ­ì— ë”°ë¼ ë°ì´í„° ë‹¤ì‹œ ë¡œë“œ
            const activeTab = document.querySelector('.tab-btn.active').getAttribute('data-tab');
            loadDataForTab(activeTab);
        }

        // íƒ­ë³„ ë°ì´í„° ë¡œë“œ
        async function loadDataForTab(tab) {
            switch (tab) {
                case 'quarterly':
                    await loadQuarterlyData();
                    break;
                case 'comparison':
                    await loadComparisonData();
                    break;
                case 'detailed':
                    await loadDetailedData();
                    break;
            }
            
            // ì¬ë¬´ì§€í‘œ ìš”ì•½ ë¡œë“œ
            await loadFinancialSummary();
        }

        // ì¬ë¬´ì§€í‘œ ìš”ì•½ ë¡œë“œ
        async function loadFinancialSummary() {
            try {
                const fsTypeText = currentFsDiv === 'CFS' ? 'ì—°ê²°ì¬ë¬´ì œí‘œ' : 'ë³„ë„ì¬ë¬´ì œí‘œ';
                console.log(`ì¬ë¬´ì§€í‘œ ìš”ì•½ ë¡œë“œ: ${currentCorpName} ${currentYear}ë…„ ${fsTypeText}`);
                
                // BS, IS, CF ë°ì´í„°ë¥¼ ëª¨ë‘ ê°€ì ¸ì™€ì„œ ì£¼ìš” ì§€í‘œ ê³„ì‚°
                const [bsResponse, isResponse, cfResponse] = await Promise.all([
                    fetch(`/api/financial/BS?corp_code=${currentCorpCode}&year=${currentYear}&fs_div=${currentFsDiv}`),
                    fetch(`/api/financial/IS?corp_code=${currentCorpCode}&year=${currentYear}&fs_div=${currentFsDiv}`),
                    fetch(`/api/financial/CF?corp_code=${currentCorpCode}&year=${currentYear}&fs_div=${currentFsDiv}`)
                ]);

                const [bsData, isData, cfData] = await Promise.all([
                    bsResponse.json(),
                    isResponse.json(),
                    cfResponse.json()
                ]);

                if (bsData.success || isData.success || cfData.success) {
                    displayFinancialSummary(bsData, isData, cfData);
                } else {
                    document.getElementById('financialSummary').innerHTML = `
                        <div class="error-message">
                            <h3>ğŸ“Š ì¬ë¬´ì§€í‘œ ìš”ì•½</h3>
                            <p>ì¬ë¬´ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                            <p><em>${currentCorpName} ${currentYear}ë…„ ${fsTypeText}</em></p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('ì¬ë¬´ì§€í‘œ ìš”ì•½ ë¡œë“œ ì˜¤ë¥˜:', error);
                document.getElementById('financialSummary').innerHTML = `
                    <div class="error-message">
                        <h3>ğŸ“Š ì¬ë¬´ì§€í‘œ ìš”ì•½</h3>
                        <p>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}</p>
                    </div>
                `;
            }
        }

        // ì¬ë¬´ì§€í‘œ ìš”ì•½ í‘œì‹œ
        function displayFinancialSummary(bsData, isData, cfData) {
            const fsTypeText = currentFsDiv === 'CFS' ? 'ì—°ê²°ì¬ë¬´ì œí‘œ' : 'ë³„ë„ì¬ë¬´ì œí‘œ';
            
            // í˜„ì¬ ê¸°ì—…ëª… ê°•ì œ í™•ì¸
            console.log(`ğŸ’¼ ì¬ë¬´ì§€í‘œ ìš”ì•½ í‘œì‹œ - í˜„ì¬ ê¸°ì—…: ${currentCorpName}`);
            
            let summaryHtml = `
                <h3>ğŸ“Š ì¬ë¬´ì§€í‘œ ìš”ì•½ - ${currentCorpName} (${currentYear}ë…„ ${fsTypeText})</h3>
                <div class="summary-grid">
            `;

            // ì£¼ìš” ì¬ë¬´ì§€í‘œ ê³„ì‚° ë° í‘œì‹œ
            if (bsData.success && bsData.data) {
                const totalAssets = getAccountValue(bsData.data, ['ìì‚°ì´ê³„', 'ìì‚°ì´ì•¡']);
                const totalLiabilities = getAccountValue(bsData.data, ['ë¶€ì±„ì´ê³„', 'ë¶€ì±„ì´ì•¡']);
                const totalEquity = getAccountValue(bsData.data, ['ìë³¸ì´ê³„', 'ìë³¸ì´ì•¡']);
                
                summaryHtml += `
                    <div class="summary-item">
                        <h4>ì¬ë¬´ìƒíƒœ (ë‹¨ìœ„: ì–µì›)</h4>
                        <p><strong>${currentCorpName}</strong></p>
                        <p>ì´ìì‚°: ${formatAmount(totalAssets)}</p>
                        <p>ì´ë¶€ì±„: ${formatAmount(totalLiabilities)}</p>
                        <p>ì´ìë³¸: ${formatAmount(totalEquity)}</p>
                        <p><small>${fsTypeText} ê¸°ì¤€</small></p>
                    </div>
                `;
            }

            if (isData.success && isData.data) {
                const revenue = getAccountValue(isData.data, ['ë§¤ì¶œì•¡', 'ìˆ˜ìµ(ë§¤ì¶œì•¡)']);
                const operatingProfit = getAccountValue(isData.data, ['ì˜ì—…ì´ìµ', 'ì˜ì—…ì´ìµ(ì†ì‹¤)']);
                const netIncome = getAccountValue(isData.data, ['ë‹¹ê¸°ìˆœì´ìµ', 'ë‹¹ê¸°ìˆœì´ìµ(ì†ì‹¤)']);
                
                summaryHtml += `
                    <div class="summary-item">
                        <h4>ê²½ì˜ì„±ê³¼ (ë‹¨ìœ„: ì–µì›)</h4>
                        <p><strong>${currentCorpName}</strong></p>
                        <p>ë§¤ì¶œì•¡: ${formatAmount(revenue)}</p>
                        <p>ì˜ì—…ì´ìµ: ${formatAmount(operatingProfit)}</p>
                        <p>ë‹¹ê¸°ìˆœì´ìµ: ${formatAmount(netIncome)}</p>
                        <p><small>${fsTypeText} ê¸°ì¤€</small></p>
                    </div>
                `;
            }

            // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ í‘œì‹œ
            if (!bsData.success && !isData.success) {
                summaryHtml += `
                    <div class="summary-item">
                        <h4>${currentCorpName} ì¬ë¬´ë°ì´í„°</h4>
                        <p>í•´ë‹¹ ì—°ë„ì˜ ì¬ë¬´ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                        <p><small>${currentYear}ë…„ ${fsTypeText}</small></p>
                    </div>
                `;
            }

            summaryHtml += '</div>';
            document.getElementById('financialSummary').innerHTML = summaryHtml;
            
            console.log(`âœ… ì¬ë¬´ì§€í‘œ ìš”ì•½ ì—…ë°ì´íŠ¸ ì™„ë£Œ: ${currentCorpName}`);
        }

        // ê³„ì •ê°’ ì¶”ì¶œ ë„ìš°ë¯¸ í•¨ìˆ˜
        function getAccountValue(data, accountNames) {
            for (const accountName of accountNames) {
                for (const [key, value] of Object.entries(data)) {
                    if (key.includes(accountName)) {
                        return Math.abs(parseInt(value)) || 0;
                    }
                }
            }
            return 0;
        }

        // ë¶„ê¸°ë³„ ë°ì´í„° ë¡œë“œ
        async function loadQuarterlyData() {
            try {
                showLoading('quarterlyData');
                
                const response = await fetch(`/api/quarterly/${currentStatementType}?corp_code=${currentCorpCode}&year=${currentYear}&fs_div=${currentFsDiv}`);
                const data = await response.json();
                
                if (data.success) {
                    displayQuarterlyChart(data.data);
                    displayQuarterlyTable(data.data);
                    showMessage('ë¶„ê¸°ë³„ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.', 'info');
                } else {
                    throw new Error(data.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ë¶„ê¸°ë³„ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                showMessage(`ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ë‹¤ë…„ë„ ë¹„êµ ë°ì´í„° ë¡œë“œ
        async function loadComparisonData() {
            try {
                showLoading('comparisonData');
                
                const response = await fetch(`/api/compare/multi-year?corp_code=${currentCorpCode}&years=${currentYear},${parseInt(currentYear)-1},${parseInt(currentYear)-2}&sj_div=${currentStatementType}&fs_div=${currentFsDiv}`);
                const data = await response.json();
                
                if (data.success) {
                    displayComparisonChart(data.data);
                    displayComparisonTable(data.data);
                    showMessage('ë‹¤ë…„ë„ ë¹„êµ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.', 'info');
                } else {
                    throw new Error(data.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ë‹¤ë…„ë„ ë¹„êµ ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜:', error);
                showMessage(`ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ìƒì„¸ ì¬ë¬´ì œí‘œ ë°ì´í„° ë¡œë“œ
        async function loadDetailedData() {
            try {
                showLoading('detailedData');
                
                const response = await fetch(`/api/financial/${currentStatementType}?corp_code=${currentCorpCode}&year=${currentYear}&fs_div=${currentFsDiv}`);
                const data = await response.json();
                
                if (data.success) {
                    displayDetailedChart(data.data);
                    displayDetailedTable(data.data);
                    showMessage('ìƒì„¸ ì¬ë¬´ì œí‘œë¥¼ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œí–ˆìŠµë‹ˆë‹¤.', 'info');
                } else {
                    throw new Error(data.error || 'ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('ìƒì„¸ ì¬ë¬´ì œí‘œ ë¡œë“œ ì˜¤ë¥˜:', error);
                showMessage(`ë°ì´í„° ë¡œë“œ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ë¶„ê¸°ë³„ ì°¨íŠ¸ í‘œì‹œ
        function displayQuarterlyChart(data) {
            const ctx = document.getElementById('quarterlyChart').getContext('2d');
            
            if (quarterlyChartInstance) {
                quarterlyChartInstance.destroy();
            }
            
            const labels = Object.keys(data);
            const datasets = [];
            
            // ì¬ë¬´ì œí‘œ ìœ í˜•ì— ë”°ë¥¸ ì£¼ìš” ê³„ì •ê³¼ëª©ë“¤ ì¶”ì¶œ
            let mainAccounts = [];
            let colors = [];
            
            if (currentStatementType === 'BS') {
                mainAccounts = ['ìì‚°ì´ê³„', 'ë¶€ì±„ì´ê³„', 'ìë³¸ì´ê³„'];
                colors = ['#007AFF', '#30D158', '#FF9500'];
            } else if (currentStatementType === 'IS') {
                mainAccounts = ['ë§¤ì¶œì•¡', 'ì˜ì—…ì´ìµ', 'ë‹¹ê¸°ìˆœì´ìµ'];
                colors = ['#007AFF', '#30D158', '#FF3B30'];
            } else if (currentStatementType === 'CF') {
                mainAccounts = ['ì˜ì—…í™œë™í˜„ê¸ˆíë¦„', 'íˆ¬ìí™œë™í˜„ê¸ˆíë¦„', 'ì¬ë¬´í™œë™í˜„ê¸ˆíë¦„'];
                colors = ['#007AFF', '#30D158', '#FF9500'];
            } else if (currentStatementType === 'SCE') {
                mainAccounts = ['ìë³¸ê¸ˆ', 'ì´ìµì‰ì—¬ê¸ˆ', 'ìë³¸ì´ê³„'];
                colors = ['#007AFF', '#30D158', '#FF9500'];
            } else {
                // ê¸°ë³¸ê°’ (í˜¼í•©)
                mainAccounts = ['ìì‚°ì´ê³„', 'ë¶€ì±„ì´ê³„', 'ìë³¸ì´ê³„', 'ë§¤ì¶œì•¡', 'ì˜ì—…ì´ìµ', 'ë‹¹ê¸°ìˆœì´ìµ'];
                colors = ['#007AFF', '#30D158', '#FF9500', '#AF52DE', '#FF6B35', '#FF3B30'];
            }
            
            mainAccounts.forEach((account, index) => {
                const accountData = labels.map(quarter => {
                    const quarterData = data[quarter];
                    // ì •í™•í•œ ê³„ì •ëª…ì´ ì—†ìœ¼ë©´ ë¹„ìŠ·í•œ ì´ë¦„ ì°¾ê¸°
                    let value = quarterData[account];
                    if (!value) {
                        // ê³„ì •ëª…ì— í¬í•¨ëœ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰
                        for (const [key, val] of Object.entries(quarterData)) {
                            if (key.includes(account) || account.includes(key.split(' ')[0])) {
                                value = val;
                                break;
                            }
                        }
                    }
                    return value ? value / 100000000 : 0; // ì–µ ë‹¨ìœ„
                });
                
                if (accountData.some(value => value > 0)) {
                    datasets.push({
                        label: account,
                        data: accountData,
                        borderColor: colors[index],
                        backgroundColor: colors[index] + '20',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4
                    });
                }
            });
            
            quarterlyChartInstance = new Chart(ctx, {
                type: 'line',
                data: { labels, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toLocaleString()}ì–µì›`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ê¸ˆì•¡ (ì–µì›)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return `${value.toLocaleString()}ì–µ`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // ë‹¤ë…„ë„ ë¹„êµ ì°¨íŠ¸ í‘œì‹œ
        function displayComparisonChart(data) {
            const ctx = document.getElementById('comparisonChart').getContext('2d');
            
            if (comparisonChartInstance) {
                comparisonChartInstance.destroy();
            }
            
            const years = Object.keys(data);
            
            // ì¬ë¬´ì œí‘œ ìœ í˜•ì— ë”°ë¥¸ ì£¼ìš” ê³„ì •ê³¼ëª©ë“¤ ì¶”ì¶œ
            let mainAccounts = [];
            let colors = [];
            
            if (currentStatementType === 'BS') {
                mainAccounts = ['ìì‚°ì´ê³„', 'ë¶€ì±„ì´ê³„', 'ìë³¸ì´ê³„'];
                colors = ['#007AFF', '#30D158', '#FF9500'];
            } else if (currentStatementType === 'IS') {
                mainAccounts = ['ë§¤ì¶œì•¡', 'ì˜ì—…ì´ìµ', 'ë‹¹ê¸°ìˆœì´ìµ'];
                colors = ['#007AFF', '#30D158', '#FF3B30'];
            } else if (currentStatementType === 'CF') {
                mainAccounts = ['ì˜ì—…í™œë™í˜„ê¸ˆíë¦„', 'íˆ¬ìí™œë™í˜„ê¸ˆíë¦„', 'ì¬ë¬´í™œë™í˜„ê¸ˆíë¦„'];
                colors = ['#007AFF', '#30D158', '#FF9500'];
            } else if (currentStatementType === 'SCE') {
                mainAccounts = ['ìë³¸ê¸ˆ', 'ì´ìµì‰ì—¬ê¸ˆ', 'ìë³¸ì´ê³„'];
                colors = ['#007AFF', '#30D158', '#FF9500'];
            } else {
                // ê¸°ë³¸ê°’
                mainAccounts = ['ìì‚°ì´ê³„', 'ë¶€ì±„ì´ê³„', 'ìë³¸ì´ê³„'];
                colors = ['#007AFF', '#30D158', '#FF9500'];
            }
            
            const datasets = mainAccounts.map((account, index) => ({
                label: account,
                data: years.map(year => {
                    const yearData = data[year];
                    // ì •í™•í•œ ê³„ì •ëª…ì´ ì—†ìœ¼ë©´ ë¹„ìŠ·í•œ ì´ë¦„ ì°¾ê¸°
                    let value = yearData[account];
                    if (!value) {
                        // ê³„ì •ëª…ì— í¬í•¨ëœ í‚¤ì›Œë“œë¡œ ê²€ìƒ‰
                        for (const [key, val] of Object.entries(yearData)) {
                            if (key.includes(account) || account.includes(key.split(' ')[0])) {
                                value = val;
                                break;
                            }
                        }
                    }
                    return value ? value / 100000000 : 0; // ì–µ ë‹¨ìœ„
                }),
                backgroundColor: colors[index],
                borderColor: colors[index],
                borderWidth: 2
            }));
            
            comparisonChartInstance = new Chart(ctx, {
                type: 'bar',
                data: { labels: years, datasets },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top'
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toLocaleString()}ì–µì›`;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ê¸ˆì•¡ (ì–µì›)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return `${value.toLocaleString()}ì–µ`;
                                }
                            }
                        }
                    }
                }
            });
        }

        // ìƒì„¸ ì°¨íŠ¸ í‘œì‹œ (ê³„ì¸µí˜• ë°” ì°¨íŠ¸)
        function displayDetailedChart(data) {
            const ctx = document.getElementById('detailedChart').getContext('2d');
            
            if (detailedChartInstance) {
                detailedChartInstance.destroy();
            }
            
            let categories = {};
            let colorSchemes = {};
            
            // ì¬ë¬´ì œí‘œ ìœ í˜•ì— ë”°ë¥¸ ë¶„ë¥˜
            if (currentStatementType === 'BS') {
                categories = {
                    'ìì‚°': [],
                    'ë¶€ì±„': [],
                    'ìë³¸': []
                };
                colorSchemes = {
                    'ìì‚°': '#007AFF',
                    'ë¶€ì±„': '#FF9500', 
                    'ìë³¸': '#30D158'
                };
                
                // ê³„ì •ê³¼ëª© ë¶„ë¥˜
                                Object.entries(data).forEach(([account, value]) => {
                    if (account.includes('ìì‚°') && !account.includes('ë¶€ì±„') && !account.includes('ìë³¸')) {
                        categories['ìì‚°'].push({ account, value: Math.abs(value) });
                    } else if (account.includes('ë¶€ì±„')) {
                        categories['ë¶€ì±„'].push({ account, value: Math.abs(value) });
                    } else if (account.includes('ìë³¸')) {
                        categories['ìë³¸'].push({ account, value: Math.abs(value) });
                    }
                });
            } else if (currentStatementType === 'IS') {
                categories = {
                    'ìˆ˜ìµ': [],
                    'ë¹„ìš©': [],
                    'ì´ìµ': []
                };
                colorSchemes = {
                    'ìˆ˜ìµ': '#007AFF',
                    'ë¹„ìš©': '#FF9500',
                    'ì´ìµ': '#30D158'
                };
                
                Object.entries(data).forEach(([account, value]) => {
                    if (account.includes('ë§¤ì¶œ') || account.includes('ìˆ˜ìµ')) {
                        categories['ìˆ˜ìµ'].push({ account, value: Math.abs(value) });
                    } else if (account.includes('ë¹„ìš©') || account.includes('ì›ê°€')) {
                        categories['ë¹„ìš©'].push({ account, value: Math.abs(value) });
                    } else if (account.includes('ì´ìµ') || account.includes('ì†ì‹¤')) {
                        categories['ì´ìµ'].push({ account, value: Math.abs(value) });
                    }
                });
            } else if (currentStatementType === 'CF') {
                categories = {
                    'ì˜ì—…í™œë™': [],
                    'íˆ¬ìí™œë™': [],
                    'ì¬ë¬´í™œë™': []
                };
                colorSchemes = {
                    'ì˜ì—…í™œë™': '#007AFF',
                    'íˆ¬ìí™œë™': '#FF9500',
                    'ì¬ë¬´í™œë™': '#30D158'
                };
                
                Object.entries(data).forEach(([account, value]) => {
                    if (account.includes('ì˜ì—…í™œë™')) {
                        categories['ì˜ì—…í™œë™'].push({ account, value: Math.abs(value) });
                    } else if (account.includes('íˆ¬ìí™œë™')) {
                        categories['íˆ¬ìí™œë™'].push({ account, value: Math.abs(value) });
                    } else if (account.includes('ì¬ë¬´í™œë™')) {
                        categories['ì¬ë¬´í™œë™'].push({ account, value: Math.abs(value) });
                    }
                });
            } else if (currentStatementType === 'SCE') {
                categories = {
                    'ìë³¸ê¸ˆ': [],
                    'ì‰ì—¬ê¸ˆ': [],
                    'ê¸°íƒ€': []
                };
                colorSchemes = {
                    'ìë³¸ê¸ˆ': '#007AFF',
                    'ì‰ì—¬ê¸ˆ': '#FF9500',
                    'ê¸°íƒ€': '#30D158'
                };
                
                Object.entries(data).forEach(([account, value]) => {
                    if (account.includes('ìë³¸ê¸ˆ')) {
                        categories['ìë³¸ê¸ˆ'].push({ account, value: Math.abs(value) });
                    } else if (account.includes('ì‰ì—¬ê¸ˆ')) {
                        categories['ì‰ì—¬ê¸ˆ'].push({ account, value: Math.abs(value) });
                    } else {
                        categories['ê¸°íƒ€'].push({ account, value: Math.abs(value) });
                    }
                });
            }
            
            // ê° ì¹´í…Œê³ ë¦¬ë³„ ìƒìœ„ 5ê°œì”© ì„ íƒ
            const labels = [];
            const values = [];
                        const backgroundColors = [];
            
            Object.entries(categories).forEach(([category, items]) => {
                items.sort((a, b) => b.value - a.value)
                     .slice(0, 5)
                     .forEach(item => {
                         labels.push(item.account);
                         values.push(item.value / 100000000); // ì–µ ë‹¨ìœ„
                         backgroundColors.push(colorSchemes[category]);
                     });
            });
            
            detailedChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels,
                    datasets: [{
                        label: 'ê¸ˆì•¡ (ì–µì›)',
                        data: values,
                        backgroundColor: backgroundColors,
                        borderWidth: 0,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.parsed.x.toLocaleString()}ì–µì›`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'ê¸ˆì•¡ (ì–µì›)'
                            },
                            ticks: {
                                callback: function(value) {
                                    return `${value.toLocaleString()}ì–µ`;
                                }
                            }
                        },
                        y: {
                            ticks: {
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        // í…Œì´ë¸” í‘œì‹œ í•¨ìˆ˜ë“¤
        function displayQuarterlyTable(data) {
            const container = document.getElementById('quarterlyData');
            container.innerHTML = createDataTable(data, 'ë¶„ê¸°ë³„');
        }

        function displayComparisonTable(data) {
            const container = document.getElementById('comparisonData');
            container.innerHTML = createDataTable(data, 'ì—°ë„ë³„');
        }

        function displayDetailedTable(data) {
            const container = document.getElementById('detailedData');
            const tableData = { [currentYear]: data };
            container.innerHTML = createDataTable(tableData, 'ê³„ì •ê³¼ëª©ë³„');
        }

        // ë°ì´í„° í…Œì´ë¸” ìƒì„±
        function createDataTable(data, type) {
            const periods = Object.keys(data);
            const allAccounts = new Set();
            
            // ëª¨ë“  ê³„ì •ê³¼ëª© ìˆ˜ì§‘
            periods.forEach(period => {
                Object.keys(data[period]).forEach(account => {
                    allAccounts.add(account);
                });
            });
            
            let html = `<table class="data-table">`;
            html += `<thead><tr><th>ê³„ì •ê³¼ëª©</th>`;
            periods.forEach(period => {
                html += `<th>${period}</th>`;
            });
            html += `</tr></thead><tbody>`;
            
            Array.from(allAccounts).forEach(account => {
                html += `<tr><td>${account}</td>`;
                periods.forEach(period => {
                    const value = data[period][account] || 0;
                    html += `<td>${formatNumber(value / 1000000)}ë°±ë§Œì›</td>`;
                });
                html += `</tr>`;
            });
            
            html += `</tbody></table>`;
            return html;
        }

        // AI ë¶„ì„ ìˆ˜í–‰
        async function performAIAnalysis(type) {
            try {
                // í˜„ì¬ ì„¤ì • ê²€ì¦
                if (!currentCorpName || !currentCorpCode) {
                    showMessage('ê¸°ì—…ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }
                
                // ê° ë¶„ì„ ìœ í˜•ë³„ë¡œ ê°œë³„ ê²°ê³¼ ì˜ì—­ ì‚¬ìš©
                const analysisTitle = document.getElementById(`${type}AnalysisResult`).querySelector('.analysis-title');
                const analysisContent = document.getElementById(`${type}AnalysisContent`);
                const analysisResult = document.getElementById(`${type}AnalysisResult`);
                
                const fsTypeText = currentFsDiv === 'CFS' ? 'ì—°ê²°ì¬ë¬´ì œí‘œ' : 'ë³„ë„ì¬ë¬´ì œí‘œ';
                
                // ì½˜ì†”ì— í˜„ì¬ ìƒíƒœ ì¶œë ¥ (ë””ë²„ê¹…ìš©)
                console.log(`ğŸ” AI ë¶„ì„ ìš”ì²­ ì •ë³´:`);
                console.log(`   - ê¸°ì—…ëª…: ${currentCorpName}`);
                console.log(`   - ê¸°ì—…ì½”ë“œ: ${currentCorpCode}`);
                console.log(`   - ì—°ë„: ${currentYear}`);
                console.log(`   - ì¬ë¬´ì œí‘œêµ¬ë¶„: ${currentFsDiv} (${fsTypeText})`);
                console.log(`   - ë¶„ì„íƒ€ì…: ${type}`);
                
                analysisTitle.textContent = `${getAnalysisTypeTitle(type)} ì§„í–‰ ì¤‘...`;
                analysisContent.innerHTML = `
                    <div class="analysis-info">
                        <p><strong>ë¶„ì„ ëŒ€ìƒ:</strong> ${currentCorpName}</p>
                        <p><strong>ê¸°ì¤€ ì—°ë„:</strong> ${currentYear}ë…„</p>
                        <p><strong>ì¬ë¬´ì œí‘œ êµ¬ë¶„:</strong> ${fsTypeText}</p>
                        <p><em>AIê°€ "${currentCorpName}"ì˜ ì¬ë¬´ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</em></p>
                    </div>
                `;
                analysisResult.style.display = 'block';
                
                // í˜„ì¬ í™œì„± íƒ­ì˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const activeTab = document.querySelector('.tab-btn.active').getAttribute('data-tab');
                const financialData = await getCurrentFinancialData(activeTab);
                
                // êµ¬ì²´ì ì¸ í”„ë¡¬í”„íŠ¸ ìƒì„±
                const prompt = getAnalysisPrompt(type);
                
                // ì„œë²„ë¡œ ì „ì†¡í•  ë°ì´í„° êµ¬ì„±
                const requestData = {
                    corp_name: currentCorpName,  // í˜„ì¬ ì„ íƒëœ ê¸°ì—…ëª…
                    year: currentYear,
                    financial_data: financialData,
                    prompt: prompt,
                    fs_div: currentFsDiv,  // ì¬ë¬´ì œí‘œ êµ¬ë¶„ ì¶”ê°€
                    corp_code: currentCorpCode  // ê¸°ì—…ì½”ë“œë„ ì¶”ê°€
                };
                
                console.log('ğŸ“¤ ì„œë²„ë¡œ ì „ì†¡í•˜ëŠ” ë°ì´í„°:', requestData);
                
                const response = await fetch(`/api/ai-analysis/${type}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                console.log('ğŸ“¥ ì„œë²„ ì‘ë‹µ:', data);
                
                if (data.success) {
                    analysisTitle.textContent = `${getAnalysisTypeTitle(type)} - ${currentCorpName} (${currentYear}ë…„ ${fsTypeText})`;
                    // ì¢…í•© ë¶„ì„ì˜ ê²½ìš° ê°ì²´ í˜•íƒœë¡œ ì˜¬ ìˆ˜ ìˆìŒ
                    if (typeof data.analysis === 'object' && data.analysis.comprehensive) {
                        analysisContent.innerHTML = `<pre style="white-space: pre-wrap; font-family: inherit;">${data.analysis.comprehensive}</pre>`;
                    } else if (typeof data.analysis === 'string') {
                        analysisContent.innerHTML = `<pre style="white-space: pre-wrap; font-family: inherit;">${data.analysis}</pre>`;
                    } else {
                        analysisContent.innerHTML = `<pre style="white-space: pre-wrap; font-family: inherit;">${JSON.stringify(data.analysis, null, 2)}</pre>`;
                    }
                    
                    // ì„±ê³µ ë©”ì‹œì§€
                    showMessage(`${currentCorpName} AI ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!`, 'success');
                } else {
                    throw new Error(data.error || 'AI ë¶„ì„ ì‹¤íŒ¨');
                }
            } catch (error) {
                console.error('AI ë¶„ì„ ì˜¤ë¥˜:', error);
                const analysisTitle = document.getElementById(`${type}AnalysisResult`).querySelector('.analysis-title');
                const analysisContent = document.getElementById(`${type}AnalysisContent`);
                
                analysisTitle.textContent = 'AI ë¶„ì„ ì˜¤ë¥˜';
                analysisContent.innerHTML = `
                    <div class="error-message">
                        <p><strong>ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:</strong></p>
                        <p>${error.message}</p>
                        <p><strong>í˜„ì¬ ì„¤ì •:</strong></p>
                        <p>ê¸°ì—…ëª…: ${currentCorpName || 'ì„ íƒë˜ì§€ ì•ŠìŒ'}</p>
                        <p>ì—°ë„: ${currentYear}</p>
                        <p><em>ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.</em></p>
                    </div>
                `;
                
                showMessage(`AI ë¶„ì„ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // ë¶„ì„ ìœ í˜•ë³„ êµ¬ì²´ì ì¸ í”„ë¡¬í”„íŠ¸ ìƒì„±
        function getAnalysisPrompt(type) {
            const prompts = {
                'ratios': `
ë‹¤ìŒ ì¬ë¬´ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì¢…í•©ì ì¸ ì¬ë¬´ë¹„ìœ¨ ë¶„ì„ì„ ìˆ˜í–‰í•´ì£¼ì„¸ìš”:

1. ìˆ˜ìµì„± ì§€í‘œ ë¶„ì„
   - ROE (ìê¸°ìë³¸ì´ìµë¥ ): ìê¸°ìë³¸ ëŒ€ë¹„ ìˆ˜ìµì„± í‰ê°€
   - ROA (ì´ìì‚°ì´ìµë¥ ): ìì‚° í™œìš© íš¨ìœ¨ì„± í‰ê°€
   - ì˜ì—…ì´ìµë¥ , ìˆœì´ìµë¥ : ìˆ˜ìµ ì°½ì¶œ ëŠ¥ë ¥ í‰ê°€

2. ì•ˆì •ì„± ì§€í‘œ ë¶„ì„
   - ë¶€ì±„ë¹„ìœ¨: ì¬ë¬´êµ¬ì¡°ì˜ ì•ˆì •ì„± í‰ê°€
   - ìê¸°ìë³¸ë¹„ìœ¨: ìë³¸ êµ¬ì¡°ì˜ ê±´ì „ì„± í‰ê°€
   - ìœ ë™ë¹„ìœ¨: ë‹¨ê¸° ì§€ê¸‰ëŠ¥ë ¥ í‰ê°€

3. ì„±ì¥ì„± ì§€í‘œ ë¶„ì„
   - ë§¤ì¶œì•¡ ê·œëª¨ì™€ ì„±ì¥ ì ì¬ë ¥
   - ìì‚° ê·œëª¨ì™€ ì„±ì¥ì„±

ê° ë¹„ìœ¨ì˜ ì˜ë¯¸ì™€ ì—…ê³„ í‰ê·  ëŒ€ë¹„ ìˆ˜ì¤€ì„ í‰ê°€í•˜ê³ , íˆ¬ìì ê´€ì ì—ì„œì˜ ì‹œì‚¬ì ì„ ì œì‹œí•´ì£¼ì„¸ìš”.
                `,
                'trends': `
ì œê³µëœ ì‹œê³„ì—´ ì¬ë¬´ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‹¤ìŒ ì¶”ì„¸ ë¶„ì„ì„ ìˆ˜í–‰í•´ì£¼ì„¸ìš”:

1. ë§¤ì¶œ ì„±ì¥ ì¶”ì„¸ ë¶„ì„
   - ì—°ë„ë³„/ë¶„ê¸°ë³„ ë§¤ì¶œ ì¦ê°ë¥  ê³„ì‚°
   - ì„±ì¥ íŒ¨í„´ ë° ê³„ì ˆì„± ë¶„ì„
   - í–¥í›„ ì„±ì¥ ì „ë§

2. ìˆ˜ìµì„± ë³€í™” ì¶”ì„¸
   - ì˜ì—…ì´ìµ, ìˆœì´ìµì˜ ë³€í™” íŒ¨í„´
   - ìˆ˜ìµì„± ê°œì„ /ì•…í™” ìš”ì¸ ë¶„ì„
   - ë§ˆì§„ìœ¨ ë³€í™” ì¶”ì´

3. ì¬ë¬´êµ¬ì¡° ë³€í™” ë¶„ì„
   - ìì‚°, ë¶€ì±„, ìë³¸ì˜ ë³€í™” ì¶”ì´
   - ì¬ë¬´ê±´ì „ì„± ê°œì„ /ì•…í™” ì—¬ë¶€
   - íˆ¬ì í™œë™ê³¼ ì¬ë¬´ ì „ëµ ë³€í™”

ê° ì¶”ì„¸ì˜ ì˜ë¯¸ë¥¼ ë¶„ì„í•˜ê³ , í–¥í›„ ì „ë§ì— ëŒ€í•œ ì¸ì‚¬ì´íŠ¸ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”.
                `,
                'investment': `
íˆ¬ìì ê´€ì ì—ì„œ ë‹¤ìŒ ì‚¬í•­ë“¤ì„ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•˜ì—¬ íˆ¬ì ë§¤ë ¥ë„ë¥¼ í‰ê°€í•´ì£¼ì„¸ìš”:

1. íˆ¬ì ê°€ì¹˜ í‰ê°€
   - ê¸°ì—…ì˜ ë‚´ì¬ê°€ì¹˜ ëŒ€ë¹„ í˜„ì¬ ìƒí™©
   - ì„±ì¥ì„±ê³¼ ìˆ˜ìµì„±ì˜ ê· í˜•
   - ë°°ë‹¹ ì •ì±… ë° ì£¼ì£¼ í™˜ì› ì •ì±…

2. íˆ¬ì ë¦¬ìŠ¤í¬ ë¶„ì„
   - ì¬ë¬´ì  ë¦¬ìŠ¤í¬ (ë¶€ì±„ ìˆ˜ì¤€, ìœ ë™ì„±)
   - ì‚¬ì—…ì  ë¦¬ìŠ¤í¬ (ìˆ˜ìµ ë³€ë™ì„±, ì‹œì¥ ì˜ì¡´ë„)
   - ê±°ì‹œê²½ì œì  ë¦¬ìŠ¤í¬ ìš”ì¸

3. íˆ¬ì ì¶”ì²œ ì˜ê²¬
   - ì¥ê¸°/ë‹¨ê¸° íˆ¬ì ê´€ì ë³„ í‰ê°€
   - ëª©í‘œì£¼ê°€ ë˜ëŠ” ê¸°ì—…ê°€ì¹˜ í‰ê°€
   - íˆ¬ì ì‹œì ê³¼ ì „ëµ ì œì•ˆ

í¬íŠ¸í´ë¦¬ì˜¤ ê´€ì ì—ì„œì˜ ìœ„ì¹˜ì™€ ì—­í• ë„ í•¨ê»˜ ë¶„ì„í•´ì£¼ì„¸ìš”.
                `,
                'comprehensive': `
ì œê³µëœ ì¬ë¬´ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ê¸°ì—…ì— ëŒ€í•œ ì¢…í•©ì ì¸ ë¶„ì„ì„ ìˆ˜í–‰í•´ì£¼ì„¸ìš”:

1. ê¸°ì—… ê°œìš” ë° ì‚¬ì—… í˜„í™©
   - ì¬ë¬´ë°ì´í„°ë¡œ íŒŒì•…ë˜ëŠ” ì‚¬ì—… ê·œëª¨ì™€ íŠ¹ì„±
   - ì‹œì¥ ì§€ìœ„ ë° ê²½ìŸë ¥ ì¶”ì •

2. ì¬ë¬´ ê±´ì „ì„± ì¢…í•© í‰ê°€
   - ìˆ˜ìµì„±, ì•ˆì •ì„±, ì„±ì¥ì„±ì˜ ì¢…í•© ì ìˆ˜
   - ê° ì˜ì—­ë³„ ê°•ì ê³¼ ì•½ì  ë¶„ì„
   - ë™ì¢…ì—…ê³„ ëŒ€ë¹„ ìƒëŒ€ì  ìœ„ì¹˜

3. ê²½ì˜ ì„±ê³¼ ë° ì „ëµ í‰ê°€
   - ê²½ì˜ì§„ì˜ ì¬ë¬´ ê´€ë¦¬ ëŠ¥ë ¥
   - ìë³¸ ë°°ë¶„ íš¨ìœ¨ì„±
   - ë¯¸ë˜ ì„±ì¥ ì „ëµì˜ íƒ€ë‹¹ì„±

4. ì¢…í•© ì˜ê²¬ ë° ê²°ë¡ 
   - SWOT ë¶„ì„ í˜•íƒœì˜ ì¢…í•© í‰ê°€
   - ì£¼ìš” ê´€ì‹¬ í¬ì¸íŠ¸ ë° ëª¨ë‹ˆí„°ë§ ì§€í‘œ
   - ì¥ê¸°ì  ê´€ì ì—ì„œì˜ ê¸°ì—… ì „ë§

ëª¨ë“  ë¶„ì„ì€ êµ¬ì²´ì ì¸ ìˆ˜ì¹˜ì™€ ê·¼ê±°ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì œì‹œí•´ì£¼ì„¸ìš”.
                `
            };
            return prompts[type] || '';
        }

        // ë¶„ì„ ìœ í˜• ì œëª© ë°˜í™˜
        function getAnalysisTypeTitle(type) {
            const titles = {
                'ratios': 'ğŸ“Š ì¬ë¬´ë¹„ìœ¨ ë¶„ì„',
                'trends': 'ğŸ“ˆ ì¶”ì„¸ ë¶„ì„',
                'investment': 'ğŸ’ íˆ¬ì ë¶„ì„',
                'comprehensive': 'ğŸ¯ ì¢…í•© ë¶„ì„'
            };
            return titles[type] || 'ë¶„ì„ ê²°ê³¼';
        }

        // í˜„ì¬ ì¬ë¬´ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function getCurrentFinancialData(tab) {
            try {
                // ì‹¤ì œ ì¬ë¬´ë°ì´í„°ë¥¼ APIì—ì„œ ê°€ì ¸ì˜¤ê¸°
                const [bsResponse, isResponse] = await Promise.all([
                    fetch(`/api/financial/BS?corp_code=${currentCorpCode}&year=${currentYear}&fs_div=${currentFsDiv}`),
                    fetch(`/api/financial/IS?corp_code=${currentCorpCode}&year=${currentYear}&fs_div=${currentFsDiv}`)
                ]);

                const [bsData, isData] = await Promise.all([
                    bsResponse.json(),
                    isResponse.json()
                ]);

                const combinedData = {
                    'BS': bsData.success ? bsData.data : {},
                    'IS': isData.success ? isData.data : {}
                };

                return combinedData;
            } catch (error) {
                console.error('ì¬ë¬´ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
                return {};
            }
        }

        // ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
        function showMessage(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type} show`;
            
            if (type === 'info') {
                setTimeout(() => {
                    statusMessage.classList.remove('show');
                }, 3000);
            }
        }

        function showLoading(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>
            `;
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('ko-KR').format(Math.round(num));
        }

        function formatAmount(amount) {
            try {
                const num = parseInt(amount);
                if (Math.abs(num) >= 1000000000000) {  // ì¡° ë‹¨ìœ„
                    return `${(num / 1000000000000).toFixed(1)}ì¡°`;
                } else if (Math.abs(num) >= 100000000) {  // ì–µ ë‹¨ìœ„
                    return `${(num / 100000000).toFixed(0)}ì–µ`;
                } else if (Math.abs(num) >= 10000) {  // ë§Œ ë‹¨ìœ„
                    return `${(num / 10000).toFixed(0)}ë§Œ`;
                } else {
                    return `${num.toLocaleString()}`;
                }
            } catch {
                return "0";
            }
        }

        // ë³„ë„/ì—°ê²° ì¬ë¬´ì œí‘œ ë¹„êµ ê¸°ëŠ¥
        async function compareFinancialStatements() {
            if (!currentCorpCode || !currentCorpName) {
                showMessage('ê¸°ì—…ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            try {
                showMessage('ë³„ë„/ì—°ê²° ì¬ë¬´ì œí‘œ ë°ì´í„°ë¥¼ ë¹„êµí•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
                
                // ì—°ê²°ì¬ë¬´ì œí‘œì™€ ë³„ë„ì¬ë¬´ì œí‘œ ë™ì‹œ ì¡°íšŒ
                const [cfsResponse, ofsResponse] = await Promise.all([
                    fetch(`/api/financial/${currentStatementType}?corp_code=${currentCorpCode}&year=${currentYear}&fs_div=CFS`),
                    fetch(`/api/financial/${currentStatementType}?corp_code=${currentCorpCode}&year=${currentYear}&fs_div=OFS`)
                ]);

                const [cfsData, ofsData] = await Promise.all([
                    cfsResponse.json(),
                    ofsResponse.json()
                ]);

                // ë¹„êµ ê²°ê³¼ í‘œì‹œ
                displayComparisonResult(cfsData, ofsData);
                
            } catch (error) {
                console.error('ì¬ë¬´ì œí‘œ ë¹„êµ ì˜¤ë¥˜:', error);
                showMessage(`ë¹„êµ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`, 'error');
            }
        }

        // ë¹„êµ ê²°ê³¼ í‘œì‹œ
        function displayComparisonResult(cfsData, ofsData) {
            const modalHtml = `
                <div class="comparison-modal" id="comparisonModal">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3>ğŸ“Š ë³„ë„/ì—°ê²° ì¬ë¬´ì œí‘œ ë¹„êµ - ${currentCorpName} (${currentYear}ë…„)</h3>
                            <button class="close-btn" onclick="closeComparisonModal()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="comparison-grid">
                                <div class="comparison-section">
                                    <h4 style="color: var(--apple-blue);">ğŸ”— ì—°ê²°ì¬ë¬´ì œí‘œ</h4>
                                    <p><strong>ìƒíƒœ:</strong> ${cfsData.success ? 'âœ… ì¡°íšŒ ì„±ê³µ' : 'âŒ ì¡°íšŒ ì‹¤íŒ¨'}</p>
                                    <p><strong>ë°ì´í„° ìˆ˜:</strong> ${cfsData.success ? Object.keys(cfsData.data).length : 0}ê°œ</p>
                                    ${cfsData.success ? '' : `<p><strong>ì˜¤ë¥˜:</strong> ${cfsData.error || 'ë°ì´í„° ì—†ìŒ'}</p>`}
                                </div>
                                <div class="comparison-section">
                                    <h4 style="color: var(--apple-orange);">ğŸ¢ ë³„ë„ì¬ë¬´ì œí‘œ</h4>
                                    <p><strong>ìƒíƒœ:</strong> ${ofsData.success ? 'âœ… ì¡°íšŒ ì„±ê³µ' : 'âŒ ì¡°íšŒ ì‹¤íŒ¨'}</p>
                                    <p><strong>ë°ì´í„° ìˆ˜:</strong> ${ofsData.success ? Object.keys(ofsData.data).length : 0}ê°œ</p>
                                    ${ofsData.success ? '' : `<p><strong>ì˜¤ë¥˜:</strong> ${ofsData.error || 'ë°ì´í„° ì—†ìŒ'}</p>`}
                                </div>
                            </div>
                            ${generateDetailedComparison(cfsData, ofsData)}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        // ìƒì„¸ ë¹„êµ ë°ì´í„° ìƒì„±
        function generateDetailedComparison(cfsData, ofsData) {
            if (!cfsData.success || !ofsData.success) {
                return '<p>ë¹„êµí•  ë°ì´í„°ê°€ ì¶©ë¶„í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>';
            }

            const cfsAccounts = Object.keys(cfsData.data);
            const ofsAccounts = Object.keys(ofsData.data);
            const commonAccounts = cfsAccounts.filter(account => ofsAccounts.includes(account));
            
            if (commonAccounts.length === 0) {
                return '<p>ê³µí†µ ê³„ì •ê³¼ëª©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }

            let comparisonHtml = `
                <div class="detailed-comparison">
                    <h4>ğŸ“ˆ ì£¼ìš” ê³„ì •ê³¼ëª© ë¹„êµ (ìƒìœ„ 10ê°œ)</h4>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>ê³„ì •ê³¼ëª©</th>
                                <th>ì—°ê²°ì¬ë¬´ì œí‘œ</th>
                                <th>ë³„ë„ì¬ë¬´ì œí‘œ</th>
                                <th>ì°¨ì´</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            // ì—°ê²°ì¬ë¬´ì œí‘œ ê¸°ì¤€ìœ¼ë¡œ ìƒìœ„ 10ê°œ ê³„ì • ë¹„êµ
            const sortedAccounts = commonAccounts
                .sort((a, b) => Math.abs(cfsData.data[b]) - Math.abs(cfsData.data[a]))
                .slice(0, 10);

            sortedAccounts.forEach(account => {
                const cfsValue = cfsData.data[account];
                const ofsValue = ofsData.data[account];
                const difference = cfsValue - ofsValue;
                const isSignificantDiff = Math.abs(difference) > Math.abs(cfsValue) * 0.05; // 5% ì´ìƒ ì°¨ì´

                comparisonHtml += `
                    <tr ${isSignificantDiff ? 'style="background-color: #fff3cd;"' : ''}>
                        <td>${account}</td>
                        <td>${formatAmount(cfsValue)}</td>
                        <td>${formatAmount(ofsValue)}</td>
                        <td style="color: ${difference > 0 ? 'var(--apple-blue)' : difference < 0 ? 'var(--apple-red)' : 'var(--apple-dark-gray)'}">
                            ${formatAmount(difference)}
                            ${isSignificantDiff ? ' âš ï¸' : ''}
                        </td>
                    </tr>
                `;
            });

            comparisonHtml += `
                        </tbody>
                    </table>
                    <p><small>âš ï¸ í‘œì‹œ: 5% ì´ìƒ ì°¨ì´ë‚˜ëŠ” í•­ëª©</small></p>
                </div>
            `;

            return comparisonHtml;
        }

        // ë¹„êµ ëª¨ë‹¬ ë‹«ê¸°
        function closeComparisonModal() {
            const modal = document.getElementById('comparisonModal');
            if (modal) {
                modal.remove();
            }
        }

        // ë³„ë„/ì—°ê²° ì¬ë¬´ì œí‘œ ì°¨ì´ í…ŒìŠ¤íŠ¸
        async function testFsDifference() {
            if (!currentCorpCode || !currentCorpName) {
                showMessage('ê¸°ì—…ì„ ë¨¼ì € ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            try {
                showMessage('ë³„ë„/ì—°ê²° ì¬ë¬´ì œí‘œ ì°¨ì´ë¥¼ í…ŒìŠ¤íŠ¸í•˜ê³  ìˆìŠµë‹ˆë‹¤...', 'info');
                
                const response = await fetch(`/api/test-fs-diff?corp_code=${currentCorpCode}&year=${currentYear}&sj_div=${currentStatementType}`);
                const data = await response.json();
                
                console.log('ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼:', data);
                
                // í…ŒìŠ¤íŠ¸ ê²°ê³¼ ëª¨ë‹¬ í‘œì‹œ
                const modalHtml = `
                    <div class="comparison-modal" id="testModal">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h3>ğŸ§ª ì¬ë¬´ì œí‘œ ì°¨ì´ í…ŒìŠ¤íŠ¸ ê²°ê³¼ - ${currentCorpName} (${currentYear}ë…„)</h3>
                                <button class="close-btn" onclick="closeTestModal()">&times;</button>
                            </div>
                            <div class="modal-body">
                                <div class="test-results">
                                    <div class="test-section">
                                        <h4>ğŸ“Š API í˜¸ì¶œ ê²°ê³¼</h4>
                                        <p><strong>ì—°ê²°ì¬ë¬´ì œí‘œ ìƒíƒœ:</strong> ${data.cfs_status} (${data.cfs_count}ê°œ í•­ëª©)</p>
                                        <p><strong>ë³„ë„ì¬ë¬´ì œí‘œ ìƒíƒœ:</strong> ${data.ofs_status} (${data.ofs_count}ê°œ í•­ëª©)</p>
                                    </div>
                                    
                                    ${data.comparison && Object.keys(data.comparison).length > 0 ? `
                                        <div class="test-section">
                                            <h4>ğŸ” ë¹„êµ ë¶„ì„</h4>
                                            <p><strong>ì—°ê²° í•„í„°ë§ í›„:</strong> ${data.comparison.cfs_filtered_count}ê°œ í•­ëª©</p>
                                            <p><strong>ë³„ë„ í•„í„°ë§ í›„:</strong> ${data.comparison.ofs_filtered_count}ê°œ í•­ëª©</p>
                                            <p><strong>ê³µí†µ ê³„ì •:</strong> ${data.comparison.common_accounts}ê°œ</p>
                                            <p><strong>ì°¨ì´ ìˆëŠ” ê³„ì •:</strong> ${data.comparison.different_accounts?.length || 0}ê°œ</p>
                                            <p><strong>ì‹¤ì œ ì°¨ì´ ì¡´ì¬:</strong> ${data.comparison.has_difference ? 'âœ… ì˜ˆ' : 'âŒ ì•„ë‹ˆì˜¤'}</p>
                                        </div>
                                        
                                        ${data.comparison.different_accounts && data.comparison.different_accounts.length > 0 ? `
                                            <div class="test-section">
                                                <h4>ğŸ’° ì°¨ì´ê°€ ìˆëŠ” ê³„ì • (ìƒìœ„ 5ê°œ)</h4>
                                                <table class="comparison-table">
                                                    <thead>
                                                        <tr>
                                                            <th>ê³„ì •ê³¼ëª©</th>
                                                            <th>ì—°ê²°ì¬ë¬´ì œí‘œ</th>
                                                            <th>ë³„ë„ì¬ë¬´ì œí‘œ</th>
                                                            <th>ì°¨ì´</th>
                                                        </tr>
                                                    </thead>
                                                    <tbody>
                                                        ${data.comparison.different_accounts.slice(0, 5).map(item => `
                                                            <tr>
                                                                <td>${item.account}</td>
                                                                <td>${formatAmount(item.cfs_amount)}</td>
                                                                <td>${formatAmount(item.ofs_amount)}</td>
                                                                <td style="color: ${item.difference > 0 ? 'var(--apple-blue)' : 'var(--apple-red)'}">
                                                                    ${formatAmount(item.difference)}
                                                                </td>
                                                            </tr>
                                                        `).join('')}
                                                    </tbody>
                                                </table>
                                            </div>
                                        ` : ''}
                                    ` : '<p>ë¹„êµ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'}
                                    
                                    <div class="test-section">
                                        <h4>ğŸ’¡ ê²°ë¡ </h4>
                                        ${data.comparison?.has_difference ? 
                                            '<p style="color: var(--apple-green);"><strong>âœ… ë³„ë„/ì—°ê²° ì¬ë¬´ì œí‘œì— ì‹¤ì œ ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤!</strong></p>' :
                                            '<p style="color: var(--apple-red);"><strong>âš ï¸ ë³„ë„/ì—°ê²° ì¬ë¬´ì œí‘œ ë°ì´í„°ì— ì°¨ì´ê°€ ì—†ìŠµë‹ˆë‹¤.</strong><br>ì´ëŠ” ë‹¤ìŒ ì´ìœ ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤:<br>1. í•´ë‹¹ ê¸°ì—…ì´ ì—°ê²°ëŒ€ìƒ ìíšŒì‚¬ê°€ ì—†ìŒ<br>2. DART APIì—ì„œ ë™ì¼í•œ ë°ì´í„° ë°˜í™˜<br>3. í•´ë‹¹ ë…„ë„/ë³´ê³ ì„œì— ë³„ë„ì¬ë¬´ì œí‘œê°€ ì—†ìŒ</p>'
                                        }
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', modalHtml);
                
                showMessage(data.comparison?.has_difference ? 
                    'ì°¨ì´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ì‹¤ì œ ì°¨ì´ê°€ ë°œê²¬ë˜ì—ˆìŠµë‹ˆë‹¤!' : 
                    'ì°¨ì´ í…ŒìŠ¤íŠ¸ ì™„ë£Œ: ì°¨ì´ê°€ ë°œê²¬ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 
                    data.comparison?.has_difference ? 'success' : 'warning'
                );
                
            } catch (error) {
                console.error('ì°¨ì´ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜:', error);
                showMessage(`ì°¨ì´ í…ŒìŠ¤íŠ¸ ì˜¤ë¥˜: ${error.message}`, 'error');
            }
        }

        // í…ŒìŠ¤íŠ¸ ëª¨ë‹¬ ë‹«ê¸°
        function closeTestModal() {
            const modal = document.getElementById('testModal');
            if (modal) {
                modal.remove();
            }
        }
    </script>
</body>
</html> 